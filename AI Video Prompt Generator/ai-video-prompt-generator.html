<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Video Prompt Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        
        /* Fix dropdown options visibility */
        select option {
            background-color: #1a1a2e;
            color: #ffffff;
            padding: 8px;
        }
        
        select option:hover {
            background-color: #8b5cf6;
        }
        
        /* Ensure select element itself has proper colors */
        select {
            color: white !important;
            background-color: rgba(255, 255, 255, 0.2) !important;
        }
        
        /* Professional prompt formatting */
        .scene-block {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(59, 130, 246, 0.1) 100%);
            border-left: 4px solid #8b5cf6;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .scene-block:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 20px rgba(139, 92, 246, 0.3);
        }
        
        .scene-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #a78bfa;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .scene-timing {
            background: rgba(139, 92, 246, 0.3);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            color: #e9d5ff;
        }
        
        .param-item {
            display: flex;
            gap: 12px;
            margin-bottom: 10px;
            align-items: flex-start;
        }
        
        .param-label {
            color: #fbbf24;
            font-weight: 600;
            min-width: 140px;
            font-size: 0.875rem;
        }
        
        .param-value {
            color: #e5e7eb;
            flex: 1;
            line-height: 1.6;
            font-size: 0.875rem;
        }
        
        .scene-icon {
            display: inline-block;
            width: 24px;
            height: 24px;
            background: #8b5cf6;
            border-radius: 50%;
            text-align: center;
            line-height: 24px;
            font-weight: bold;
            color: white;
        }
        
        #promptContainer::-webkit-scrollbar {
            width: 8px;
        }
        
        #promptContainer::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }
        
        #promptContainer::-webkit-scrollbar-thumb {
            background: #8b5cf6;
            border-radius: 4px;
        }
        
        #promptContainer::-webkit-scrollbar-thumb:hover {
            background: #7c3aed;
        }
        
        /* Editable mode styles */
        .param-value[contenteditable="true"] {
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid #8b5cf6;
            border-radius: 4px;
            padding: 4px 8px;
            cursor: text;
            transition: all 0.2s;
        }
        
        .param-value[contenteditable="true"]:focus {
            outline: none;
            background: rgba(139, 92, 246, 0.2);
            border-color: #a78bfa;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
        }
        
        .param-value[contenteditable="true"]:hover {
            border-color: #a78bfa;
        }
        
        /* Toggle switch hidden input */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900">
    <div class="p-6">
        <div class="max-w-4xl mx-auto">
            <!-- Header -->
            <div class="text-center mb-8">
                <div class="flex items-center justify-center gap-3 mb-4">
                    <svg class="w-12 h-12 text-purple-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                    </svg>
                    <h1 class="text-4xl font-bold text-white">AI Video Prompt Generator</h1>
                </div>
                <p class="text-purple-200">Transform your ideas into professional video prompts</p>
                <p class="text-purple-300 text-sm mt-2">Works with Runway ML, Pika Labs, Stability AI & more</p>
            </div>

            <!-- Main Card -->
            <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-8 shadow-2xl border border-white/20">
                
                <!-- API Configuration Section -->
                <div class="mb-6 p-4 bg-white/5 rounded-lg border border-purple-400/30">
                    <h3 class="text-white font-semibold mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        API Configuration
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-white font-medium mb-2">AI Provider</label>
                            <select 
                                id="apiProvider"
                                class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 text-white focus:outline-none focus:ring-2 focus:ring-purple-400"
                            >
                                <option value="openrouter">OpenRouter</option>
                                <option value="openai">OpenAI</option>
                                <option value="anthropic">Anthropic (Claude)</option>
                                <option value="groq">Groq</option>
                                <option value="together">Together AI</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-white font-medium mb-2">API Key</label>
                            <input 
                                type="password" 
                                id="apiKey"
                                placeholder="Enter your API key"
                                class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-purple-400"
                            />
                        </div>
                    </div>
                    
                    <!-- OpenRouter Model Selection (shown only when OpenRouter is selected) -->
                    <div id="openRouterModelSection" class="mt-4 hidden">
                        <label class="block text-white font-medium mb-2">OpenRouter Model</label>
                        <select 
                            id="openRouterModel"
                            class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 text-white focus:outline-none focus:ring-2 focus:ring-purple-400 mb-2"
                        >
                            <option value="anthropic/claude-3.5-sonnet">Claude 3.5 Sonnet (Recommended)</option>
                            <option value="anthropic/claude-3-opus">Claude 3 Opus</option>
                            <option value="anthropic/claude-3-haiku">Claude 3 Haiku (Fast & Cheap)</option>
                            <option value="openai/gpt-4-turbo">GPT-4 Turbo</option>
                            <option value="openai/gpt-4o">GPT-4o</option>
                            <option value="google/gemini-pro-1.5">Gemini Pro 1.5</option>
                            <option value="meta-llama/llama-3.1-70b-instruct">Llama 3.1 70B</option>
                            <option value="meta-llama/llama-3.1-405b-instruct">Llama 3.1 405B</option>
                            <option value="mistralai/mixtral-8x22b-instruct">Mixtral 8x22B</option>
                            <option value="custom">ðŸ”§ Custom Model</option>
                        </select>
                        
                        <!-- Custom Model Input (shown only when "custom" is selected) -->
                        <div id="customModelSection" class="hidden">
                            <input 
                                type="text" 
                                id="customModelInput"
                                placeholder="Enter model name (e.g., anthropic/claude-3.5-sonnet)"
                                class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-purple-400"
                            />
                            <p class="text-xs text-purple-200 mt-1">
                                ðŸ’¡ Find available models at <a href="https://openrouter.ai/models" target="_blank" class="text-blue-300 hover:underline">openrouter.ai/models</a>
                            </p>
                        </div>
                    </div>
                    
                    <p class="text-xs text-purple-200 mt-2">
                        ðŸ”’ Your API key is stored locally in your browser and never sent anywhere except to your chosen provider
                    </p>
                </div>

                <!-- Input Section -->
                <div class="mb-6">
                    <label class="block text-white font-medium mb-2">
                        Describe Your Video Idea
                    </label>
                    <textarea 
                        id="userIdea" 
                        rows="4"
                        placeholder="E.g., 'A peaceful morning in a coffee shop' or 'Drone shot flying over a mountain range at sunset'"
                        class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-purple-400 resize-none"
                    ></textarea>
                    <p class="text-xs text-purple-200 mt-1">ðŸ’¡ Be as detailed or simple as you want - we'll enhance it!</p>
                </div>

                <!-- Settings -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div>
                        <label class="block text-white font-medium mb-2">Duration</label>
                        <select 
                            id="duration"
                            class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 text-white focus:outline-none focus:ring-2 focus:ring-purple-400"
                        >
                            <option value="3">3 seconds</option>
                            <option value="5" selected>5 seconds</option>
                            <option value="8">8 seconds</option>
                            <option value="10">10 seconds</option>
                            <option value="15">15 seconds</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-white font-medium mb-2">Aspect Ratio</label>
                        <select 
                            id="aspectRatio"
                            class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 text-white focus:outline-none focus:ring-2 focus:ring-purple-400"
                        >
                            <option value="16:9">16:9 (Landscape)</option>
                            <option value="9:16">9:16 (Portrait)</option>
                            <option value="1:1">1:1 (Square)</option>
                            <option value="4:3">4:3 (Classic)</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-white font-medium mb-2">Style</label>
                        <select 
                            id="style"
                            class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 text-white focus:outline-none focus:ring-2 focus:ring-purple-400"
                        >
                            <option value="cinematic">Cinematic</option>
                            <option value="realistic">Realistic</option>
                            <option value="animated">Animated</option>
                            <option value="documentary">Documentary</option>
                            <option value="artistic">Artistic</option>
                        </select>
                    </div>
                </div>

                <!-- Generate Button -->
                <button 
                    id="generateBtn"
                    class="w-full bg-gradient-to-r from-purple-500 to-blue-500 hover:from-purple-600 hover:to-blue-600 text-white font-bold py-4 px-6 rounded-lg transition-all duration-200 flex items-center justify-center gap-2 shadow-lg hover:shadow-xl transform hover:scale-[1.02]"
                >
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                    <span>Generate Professional Prompt</span>
                </button>

                <!-- Error Message -->
                <div id="errorMessage" class="hidden mt-4 p-4 bg-red-500/20 border border-red-500 rounded-lg">
                    <div class="flex items-start gap-2">
                        <svg class="w-5 h-5 text-red-300 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <p id="errorText" class="text-red-100"></p>
                    </div>
                </div>

                <!-- Generated Prompt -->
                <div id="generatedPrompt" class="hidden mt-6 p-6 bg-white/5 rounded-lg border border-purple-400/30">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-white font-semibold flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            Your Professional Video Prompt
                        </h3>
                        <div class="flex gap-2">
                            <button 
                                id="editToggle"
                                class="px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-colors flex items-center gap-2"
                            >
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                </svg>
                                Edit
                            </button>
                            <button 
                                id="copyBtn"
                                class="px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg transition-colors flex items-center gap-2"
                            >
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                </svg>
                                Copy
                            </button>
                        </div>
                    </div>
                    <div id="promptContainer" class="max-h-96 overflow-y-auto"></div>
                </div>
            </div>

            <!-- Footer -->
            <div class="mt-8 text-center">
                <p class="text-purple-200 text-sm">
                    ðŸ’¡ <strong>Pro Tip:</strong> Use the edit button to customize any part of the generated prompt
                </p>
            </div>
        </div>
    </div>

    <script>
        // DOM elements
        const userIdea = document.getElementById('userIdea');
        const durationSelect = document.getElementById('duration');
        const aspectRatioSelect = document.getElementById('aspectRatio');
        const styleSelect = document.getElementById('style');
        const generateBtn = document.getElementById('generateBtn');
        const errorMessage = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');
        const generatedPrompt = document.getElementById('generatedPrompt');
        const promptContainer = document.getElementById('promptContainer');
        const copyBtn = document.getElementById('copyBtn');
        const editToggle = document.getElementById('editToggle');
        const apiProvider = document.getElementById('apiProvider');
        const apiKey = document.getElementById('apiKey');
        const openRouterModelSection = document.getElementById('openRouterModelSection');
        const openRouterModel = document.getElementById('openRouterModel');
        const customModelSection = document.getElementById('customModelSection');
        const customModelInput = document.getElementById('customModelInput');

        // Load saved API key from localStorage
        const savedProvider = localStorage.getItem('apiProvider');
        const savedApiKey = localStorage.getItem('apiKey');
        const savedOpenRouterModel = localStorage.getItem('openRouterModel');
        const savedCustomModel = localStorage.getItem('customModel');
        
        if (savedProvider) apiProvider.value = savedProvider;
        if (savedApiKey) apiKey.value = savedApiKey;
        if (savedOpenRouterModel) openRouterModel.value = savedOpenRouterModel;
        if (savedCustomModel) customModelInput.value = savedCustomModel;

        // Show/hide OpenRouter model section based on provider selection
        function toggleOpenRouterSection() {
            if (apiProvider.value === 'openrouter') {
                openRouterModelSection.classList.remove('hidden');
            } else {
                openRouterModelSection.classList.add('hidden');
            }
        }

        // Show/hide custom model input based on model selection
        function toggleCustomModelSection() {
            if (openRouterModel.value === 'custom') {
                customModelSection.classList.remove('hidden');
            } else {
                customModelSection.classList.add('hidden');
            }
        }

        // Initialize visibility on page load
        toggleOpenRouterSection();
        toggleCustomModelSection();

        // Save API config when changed
        apiProvider.addEventListener('change', () => {
            localStorage.setItem('apiProvider', apiProvider.value);
            toggleOpenRouterSection();
        });

        apiKey.addEventListener('change', () => {
            localStorage.setItem('apiKey', apiKey.value);
        });

        openRouterModel.addEventListener('change', () => {
            localStorage.setItem('openRouterModel', openRouterModel.value);
            toggleCustomModelSection();
        });

        customModelInput.addEventListener('change', () => {
            localStorage.setItem('customModel', customModelInput.value);
        });

        // Edit toggle functionality
        let isEditMode = false;
        editToggle.addEventListener('click', () => {
            isEditMode = !isEditMode;
            const editableElements = promptContainer.querySelectorAll('.param-value');
            editableElements.forEach(el => {
                el.contentEditable = isEditMode;
            });
            editToggle.innerHTML = isEditMode ? `
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                Done
            ` : `
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                </svg>
                Edit
            `;
        });

        // Generate button
        generateBtn.addEventListener('click', generatePrompt);

        // Copy button
        copyBtn.addEventListener('click', () => {
            const plainText = promptContainer.innerText;
            navigator.clipboard.writeText(plainText);
            copyBtn.innerHTML = `
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                Copied!
            `;
            setTimeout(() => {
                copyBtn.innerHTML = `
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                    </svg>
                    Copy
                `;
            }, 2000);
        });

        // API configurations
        const API_CONFIGS = {
            openrouter: {
                url: 'https://openrouter.ai/api/v1/chat/completions',
                getModel: () => {
                    const selectedModel = openRouterModel.value;
                    if (selectedModel === 'custom') {
                        const customModel = customModelInput.value.trim();
                        if (!customModel) {
                            throw new Error('Please enter a custom model name');
                        }
                        return customModel;
                    }
                    return selectedModel;
                },
                headers: (apiKey) => ({
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`,
                    'HTTP-Referer': window.location.href,
                    'X-Title': 'AI Video Prompt Generator'
                })
            },
            openai: {
                url: 'https://api.openai.com/v1/chat/completions',
                model: 'gpt-4-turbo-preview',
                headers: (apiKey) => ({
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                })
            },
            anthropic: {
                url: 'https://api.anthropic.com/v1/messages',
                model: 'claude-3-5-sonnet-20241022',
                headers: (apiKey) => ({
                    'Content-Type': 'application/json',
                    'x-api-key': apiKey,
                    'anthropic-version': '2023-06-01'
                }),
                format: 'anthropic' // Special flag for Anthropic's different format
            },
            groq: {
                url: 'https://api.groq.com/openai/v1/chat/completions',
                model: 'llama-3.1-70b-versatile',
                headers: (apiKey) => ({
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                })
            },
            together: {
                url: 'https://api.together.xyz/v1/chat/completions',
                model: 'meta-llama/Meta-Llama-3.1-70B-Instruct-Turbo',
                headers: (apiKey) => ({
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                })
            }
        };

        async function generatePrompt() {
            const idea = userIdea.value.trim();
            const duration = durationSelect.value;
            const aspectRatio = aspectRatioSelect.value;
            const style = styleSelect.value;
            const provider = apiProvider.value;
            const key = apiKey.value.trim();

            if (!idea) {
                showError('Please describe your video idea');
                return;
            }

            if (!key) {
                showError('Please enter your API key');
                return;
            }

            hideError();
            hidePrompt();
            setLoading(true);

            try {
                const config = API_CONFIGS[provider];
                
                // Get the model - either static or dynamic (for OpenRouter)
                let modelToUse;
                if (config.getModel) {
                    try {
                        modelToUse = config.getModel();
                    } catch (error) {
                        setLoading(false);
                        showError(error.message);
                        return;
                    }
                } else {
                    modelToUse = config.model;
                }
                
                const systemPrompt = `You are a professional video prompt engineer specializing in AI video generation. Create detailed, technical prompts optimized for platforms like Runway ML, Pika Labs, and Stable Video Diffusion.

Format your response with clear scene breakdowns:
**SCENE X (timing):**
- Visual Description: [detailed visual elements]
- Camera Movement: [specific camera movements]
- Lighting: [lighting setup]
- Style: [artistic style and mood]
- Technical: [aspect ratio, duration, quality settings]

Be specific, technical, and professional.`;

                const userPrompt = `Create a professional video prompt for this idea:
"${idea}"

Settings:
- Duration: ${duration} seconds
- Aspect Ratio: ${aspectRatio}
- Style: ${style}

Break it into scenes with detailed technical parameters.`;

                let response;
                
                if (config.format === 'anthropic') {
                    // Anthropic uses a different API format
                    response = await fetch(config.url, {
                        method: 'POST',
                        headers: config.headers(key),
                        body: JSON.stringify({
                            model: modelToUse,
                            max_tokens: 2048,
                            system: systemPrompt,
                            messages: [
                                {
                                    role: 'user',
                                    content: userPrompt
                                }
                            ]
                        })
                    });
                } else {
                    // OpenAI-compatible format
                    response = await fetch(config.url, {
                        method: 'POST',
                        headers: config.headers(key),
                        body: JSON.stringify({
                            model: modelToUse,
                            messages: [
                                {
                                    role: 'system',
                                    content: systemPrompt
                                },
                                {
                                    role: 'user',
                                    content: userPrompt
                                }
                            ],
                            max_tokens: 2048,
                            temperature: 0.7
                        })
                    });
                }

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `API Error: ${response.status}`);
                }

                const data = await response.json();
                
                let generatedText;
                if (config.format === 'anthropic') {
                    generatedText = data.content[0].text;
                } else {
                    generatedText = data.choices[0].message.content;
                }

                showPrompt(generatedText);
            } catch (error) {
                console.error('Error:', error);
                showError(error.message || 'Failed to generate prompt. Please check your API key and try again.');
            } finally {
                setLoading(false);
            }
        }

        function setLoading(loading) {
            if (loading) {
                generateBtn.disabled = true;
                generateBtn.innerHTML = `
                    <svg class="w-5 h-5 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                    <span>Generating...</span>
                `;
            } else {
                generateBtn.disabled = false;
                generateBtn.innerHTML = `
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                    <span>Generate Professional Prompt</span>
                `;
            }
        }

        function showError(message) {
            errorText.textContent = message;
            errorMessage.classList.remove('hidden');
        }

        function hideError() {
            errorMessage.classList.add('hidden');
        }

        function showPrompt(text) {
            // Parse and format the prompt
            const formattedHTML = formatPrompt(text);
            promptContainer.innerHTML = formattedHTML;
            generatedPrompt.classList.remove('hidden');
            generatedPrompt.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function formatPrompt(text) {
            // Parse the text and create beautiful formatted HTML
            let html = '';
            
            // Split into scenes
            const scenePattern = /\*\*SCENE\s+(\d+)\s*\(([^)]+)\)\*\*/gi;
            const scenes = text.split(scenePattern);
            
            // If no structured format detected, try to format anyway
            if (scenes.length < 2) {
                return formatUnstructuredPrompt(text);
            }
            
            // Process structured scenes
            for (let i = 1; i < scenes.length; i += 3) {
                const sceneNum = scenes[i];
                const timing = scenes[i + 1];
                const content = scenes[i + 2];
                
                html += `
                    <div class="scene-block">
                        <div class="scene-title">
                            <span class="scene-icon">${sceneNum}</span>
                            <span>SCENE ${sceneNum}</span>
                            <span class="scene-timing">${timing}</span>
                        </div>
                        <div class="scene-content">
                            ${formatSceneContent(content)}
                        </div>
                    </div>
                `;
            }
            
            return html || formatUnstructuredPrompt(text);
        }

        function formatSceneContent(content) {
            let html = '';
            
            // Parse bullet points or lines
            const lines = content.split('\n').filter(line => line.trim());
            
            for (const line of lines) {
                const trimmed = line.trim();
                if (!trimmed) continue;
                
                // Check if it's a parameter line (starts with - or has :)
                const match = trimmed.match(/^[-â€¢]\s*(.+?):\s*(.+)$/);
                if (match) {
                    const label = match[1].trim();
                    const value = match[2].trim();
                    html += `
                        <div class="param-item">
                            <div class="param-label">${label}:</div>
                            <div class="param-value" contenteditable="false">${value}</div>
                        </div>
                    `;
                } else if (trimmed.match(/^(.+?):\s*(.+)$/)) {
                    // Alternative format without bullet
                    const parts = trimmed.split(':');
                    const label = parts[0].trim().replace(/^[-â€¢*]\s*/, '');
                    const value = parts.slice(1).join(':').trim();
                    html += `
                        <div class="param-item">
                            <div class="param-label">${label}:</div>
                            <div class="param-value" contenteditable="false">${value}</div>
                        </div>
                    `;
                }
            }
            
            return html;
        }

        function formatUnstructuredPrompt(text) {
            // Fallback for unstructured text - still make it look good
            const paragraphs = text.split('\n\n');
            let html = '';
            let sceneNum = 1;
            
            for (const para of paragraphs) {
                if (para.trim()) {
                    html += `
                        <div class="scene-block">
                            <div class="scene-title">
                                <span class="scene-icon">${sceneNum}</span>
                                <span>Scene ${sceneNum}</span>
                            </div>
                            <div class="param-value" contenteditable="false" style="margin-top: 12px;">
                                ${para.trim()}
                            </div>
                        </div>
                    `;
                    sceneNum++;
                }
            }
            
            return html || `<div class="param-value" contenteditable="false">${text}</div>`;
        }

        function hidePrompt() {
            generatedPrompt.classList.add('hidden');
        }
    </script>
</body>
</html>
